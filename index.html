<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Python Notes Repository</title>
<style>
  html { scroll-padding-top: 50px; }
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f7fa; color:#333; font-size:1rem; }

  /* Header */
  header { background:#2d6cdf; color:white; padding:5px 10px; text-align:center; position:sticky; top:0; z-index:1000; }
  header h1 { margin:0; font-size:1.3em; display:inline; }
  header p { margin:2px 0 0 0; font-size:0.75em; color:yellow; }

  nav { margin-top:3px; }
  nav a { color:white; text-decoration:none; margin:0 6px; font-weight:bold; padding:3px 6px; border-radius:4px; transition:0.3s; display:inline-block; margin-bottom:3px; font-size:0.9em; }
  nav a:hover { text-decoration:underline; color:#ffdd57; }
  nav a.active { background:#ffdd57; color:#2d6cdf; }

  /* Controls */
  #controls { margin-top:3px; display:flex; gap:5px; justify-content:center; align-items:center; flex-wrap:wrap; }
  #refreshBtn { background:#ffdd57; color:#2d6cdf; border:none; padding:4px 8px; border-radius:5px; cursor:pointer; font-weight:bold; margin-top:3px; font-size:0.85em; }
  #refreshBtn:hover { background:#ffd633; }

  /* Section headings */
  h2 { background:#e8eefc; padding:8px; border-left:4px solid #2d6cdf; margin-top:20px; font-size:1.1em; }

  /* Lists */
  li { margin:4px 0; padding:4px 8px; word-break:break-word; display:block; font-size:0.95em; }
  .actions { float:right; }
  .unit-content li .actions { display:inline-block; margin-top:2px; float:none; }

  /* Collapsible titles */
  b.collapsible-title {
    cursor:pointer;
    display:inline-block;
    color:#2d6cdf;
    margin:6px 0;
    padding:3px 6px;
    text-align:left;
    font-size:1em;
  }
  .collapsible-icon {
    display:inline-block;
    width:16px;
    text-align:center;
    margin-right:4px;
    font-weight:bold;
  }

  a { text-decoration:none; color:#1a4bb7; font-weight:500; }
  a:hover { text-decoration:underline; color:#d35400; }

  .download { background:#2d6cdf; color:white; padding:2px 6px; border-radius:5px; font-size:0.75em; margin-left:5px; white-space:nowrap; }
  .download:hover { background:#ff5733; }

  /* Collapsible content */
  .unit-content { margin-left:15px; margin-top:3px; display:none; }

  /* Container */
  .container { max-width:960px; width:95%; margin:auto; padding:15px; background:white; box-shadow:0 0 10px rgba(0,0,0,0.1); border-radius:8px; }

  /* Footer */
  footer { text-align:center; padding:10px; margin-top:20px; background:#2d6cdf; color:white; font-size:0.8em; }

  /* Responsive */
  @media(max-width:600px){
    nav a { margin:2px 1px; padding:3px 4px; font-size:0.75em; }
    .container { padding:10px; }
    b.collapsible-title { font-size:0.9em; display:block; }
    #controls { flex-direction:column; }
  }
</style>
</head>
<body>

<header>
  <h1>ðŸ“˜ Python Notes Repository</h1>
  <p>:BMC301: :Python Programming: :MCA 3rd Semester:</p>

  <nav>
    <a href="#syllabus">Syllabus</a>
    <a href="#notes_programs">Notes_Programs</a>
    <a href="#assignments">Assignments</a>
    <a href="#ebooks">Ebooks</a>
    <a href="#exampapers">ExamPapers</a>
  </nav>

  <div id="controls">
    <button id="refreshBtn">ðŸ”„ Refresh Data</button>
  </div>
</header>

<div class="container">
  <h2 id="syllabus">Syllabus</h2>
  <div id="syllabus-list"></div>

  <h2 id="notes_programs">Notes_Programs</h2>
  <div id="notes_programs-list"></div>

  <h2 id="assignments">Assignments</h2>
  <div id="assignments-list"></div>

  <h2 id="ebooks">Ebooks</h2>
  <div id="ebooks-list"></div>

  <h2 id="exampapers">ExamPapers</h2>
  <div id="exampapers-list"></div>
</div>

<footer>
  Developed & Maintained by Naveen Upreti | 2025
</footer>

<script>
const rawBase = "https://raw.githubusercontent.com/naveenupreti/Python-Notes/main/";
function getCacheBuster() { return "?v=" + new Date().getTime(); }

function normalizeFileEntry(entry) {
  if (typeof entry === "string") return { path: entry };
  if (typeof entry === "object" && entry !== null) return entry;
  return null;
}

function createIcon() {
  const icon = document.createElement("span");
  icon.className = "collapsible-icon";
  icon.textContent = "+";
  return icon;
}

function renderCollapsibleList(containerId, files, cssClass) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  if (!files || files.length === 0) { container.innerHTML = "<p>No files available.</p>"; return; }

  const li = document.createElement("li");
  const icon = createIcon();
  li.innerHTML = `<b class="collapsible-title ${cssClass}"></b>`;
  li.querySelector("b").appendChild(icon);
  li.querySelector("b").appendChild(document.createTextNode(containerId.replace("-list","").toUpperCase()));

  const ul = document.createElement("ul");
  ul.className = "unit-content";
  ul.style.display = "none";

  const cacheBuster = getCacheBuster();
  files.forEach(f => {
    const fileObj = normalizeFileEntry(f);
    if (!fileObj) return;

    // Skip hidden files
    if (fileObj.hidden) return;

    const filePath = rawBase + fileObj.path + cacheBuster;
    const fileName = fileObj.title || fileObj.path.split("/").pop();
    const liFile = document.createElement("li");
    liFile.innerHTML = `<a href="${filePath}" target="_blank" rel="noopener">${fileName}</a>
      <span class="actions">
        <a class="download" href="${filePath}" download>Download</a>
      </span>`;
    ul.appendChild(liFile);
  });

  li.appendChild(ul);
  container.appendChild(li);

  li.querySelector("b").addEventListener("click", () => {
    ul.style.display = ul.style.display === "block" ? "none" : "block";
    icon.textContent = ul.style.display === "block" ? "âˆ’" : "+";
  });
}

function renderUnits(containerId, unitsObj) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  if (!unitsObj || Object.keys(unitsObj).length === 0) { container.innerHTML = "<p>No data available.</p>"; return; }

  const cacheBuster = getCacheBuster();

  for (const [unitName, files] of Object.entries(unitsObj)) {
    const li = document.createElement("li");
    const icon = createIcon();
    li.innerHTML = `<b class="collapsible-title"></b>`;
    li.querySelector("b").appendChild(icon);
    li.querySelector("b").appendChild(document.createTextNode(unitName));

    const ul = document.createElement("ul");
    ul.className = "unit-content";
    ul.style.display = "none";

    files.forEach(f => {
      const fileObj = normalizeFileEntry(f);
      if (!fileObj) return;

      // Skip hidden files
      if (fileObj.hidden) return;

      const filePath = rawBase + fileObj.path + cacheBuster;
      const fileName = fileObj.title || fileObj.path.split("/").pop();
      const liFile = document.createElement("li");
      liFile.innerHTML = `<a href="${filePath}" target="_blank" rel="noopener">${fileName}</a>
        <span class="actions">
          <a class="download" href="${filePath}" download>Download</a>
        </span>`;
      ul.appendChild(liFile);
    });

    li.appendChild(ul);
    container.appendChild(li);

    li.querySelector("b").addEventListener("click", () => {
      ul.style.display = ul.style.display === "block" ? "none" : "block";
      icon.textContent = ul.style.display === "block" ? "âˆ’" : "+";
    });
  }
}

async function loadData(force=false) {
  if (force) localStorage.removeItem("pythonNotesData");

  let data = localStorage.getItem("pythonNotesData");
  if (data) data = JSON.parse(data);
  else {
    try {
      const res = await fetch(rawBase + "data.json" + getCacheBuster(), { cache: "no-store" });
      if (!res.ok) throw new Error("Failed to fetch data.json");
      data = await res.json();
      try { localStorage.setItem("pythonNotesData", JSON.stringify(data)); } catch(e) {}
    } catch (err) {
      alert("Error loading data: " + err.message); return;
    }
  }

  renderCollapsibleList("syllabus-list", data.syllabus, "syllabus-title");
  renderUnits("notes_programs-list", data.notes_programs);
  renderCollapsibleList("assignments-list", data.assignments, "assignments-title");
  renderCollapsibleList("ebooks-list", data.ebooks, "ebook-title");
  renderCollapsibleList("exampapers-list", data.exampapers, "exampaper-title");
}

document.getElementById("refreshBtn").addEventListener("click", () => loadData(true));
loadData(false);
</script>

</body>
</html>

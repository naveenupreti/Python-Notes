<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Python Notes Repository</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background:#f5f7fa; color:#333; }
  header { background:#2d6cdf; color:white; padding:10px 15px; display:flex; justify-content:space-between; align-items:center; position:sticky; top:0; z-index:1000; }
  header h1 { margin:0; font-size:1.4em; }
  header p { margin:0; font-size:0.85em; }

  .row { display:flex; height:calc(100vh - 60px); overflow:hidden; }

  /* Sidebar */
  .sidenav {
    width:250px;
    min-width:150px;
    max-width:400px;
    background:#fff;
    border-right:1px solid #ccc;
    overflow-y:auto;
    resize: horizontal;
    padding:0;
  }
  .accordion { display:block; width:100%; border:none; outline:none; text-align:left; padding:10px 14px; background:#f1f1f1; font-size:15px; cursor:pointer; transition:0.2s; }
  .accordion:hover { background:#ddd; }
  .accordion.active { background:#2d6cdf; color:white; }
  .submenu { display:none; padding-left:10px; }
  .submenu a, .submenu button.unit-btn { display:block; padding:6px 8px; text-decoration:none; color:#1a4bb7; background:none; border:none; text-align:left; width:100%; cursor:pointer; }
  .submenu a:hover { color:#d35400; text-decoration:underline; }
  .unit-content { display:none; padding-left:12px; }

  /* Main content */
  .main { flex:1; padding:12px; overflow-y:auto; background:#fafafa; }

  /* Footer */
  footer { text-align:center; padding:10px; background:#2d6cdf; color:white; font-size:0.85em; }

  /* PDF button */
  .pdf-controls { margin-bottom:10px; }
  .pdf-controls button { background:#2d6cdf; color:white; border:none; padding:5px 8px; border-radius:4px; cursor:pointer; font-size:13px; }
  .pdf-controls button:hover { background:#1a4bb7; }

  pre { white-space:pre-wrap; word-wrap:break-word; }

</style>
</head>
<body>

<header>
  <div>
    <h1>üìò Python Notes Repository</h1>
    <p>:BMC301: Python Programming : MCA 3rd Semester:</p>
  </div>
  <button id="refreshBtn">üîÑ Refresh Data</button>
</header>

<div class="row">
  <!-- Sidebar -->
  <div class="sidenav" id="sidebar">
    <button class="accordion">üìë Syllabus</button>
    <div class="submenu" id="syllabus-list"></div>

    <button class="accordion">üìù Notes</button>
    <div class="submenu" id="notes-list"></div>

    <button class="accordion">üíª Programs</button>
    <div class="submenu" id="programs-list"></div>

    <button class="accordion">üìÇ Assignments</button>
    <div class="submenu" id="assignments-list"></div>

    <button class="accordion">üìö Ebooks</button>
    <div class="submenu" id="ebooks-list"></div>

    <button class="accordion">üìÑ Exam Papers</button>
    <div class="submenu" id="exampapers-list"></div>
  </div>

  <!-- Main panel -->
  <div class="main" id="content">
    <h2>Welcome üëã</h2>
    <p>Select a category from the left menu to explore Notes, Programs, Assignments, Syllabus, Ebooks, and Exam Papers.</p>
  </div>
</div>

<footer>
  Developed & Maintained by Naveen Upreti | 2025
</footer>

<script>
// Base URL via GitHub Pages (renders PDFs correctly)
const baseURL = "https://naveenupreti.github.io/Python-Notes/";

// Cache buster
function getCacheBuster() { return "?v=" + new Date().getTime(); }
function normalizeFileEntry(entry) { if(typeof entry==="string") return {path:entry}; if(typeof entry==="object" && entry!==null) return entry; return null; }

// Render units with collapsible files
function renderUnits(containerId, unitsObj) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  if(!unitsObj || Object.keys(unitsObj).length===0){ container.innerHTML="<p>No data available.</p>"; return; }

  for(const [unitName, files] of Object.entries(unitsObj)){
    const unitBtn = document.createElement("button");
    unitBtn.className="unit-btn";
    unitBtn.textContent=unitName;

    const unitDiv = document.createElement("div");
    unitDiv.className="unit-content";

    files.forEach(f=>{
      const fileObj=normalizeFileEntry(f);
      if(!fileObj || fileObj.hidden) return;
      const filePath = baseURL+fileObj.path+getCacheBuster();
      const fileName = fileObj.title||fileObj.path.split("/").pop();

      const link=document.createElement("a");
      link.href="#";
      link.textContent=fileName;
      link.addEventListener("click",()=>loadInContent(filePath,fileName));
      unitDiv.appendChild(link);
    });

    unitBtn.addEventListener("click",()=>unitDiv.style.display=unitDiv.style.display==="block"?"none":"block");

    container.appendChild(unitBtn);
    container.appendChild(unitDiv);
  }
}

// Render simple lists like syllabus, ebooks, exampapers
function renderList(containerId, files){
  const container=document.getElementById(containerId);
  container.innerHTML="";
  if(!files||files.length===0){container.innerHTML="<p>No files available.</p>";return;}
  files.forEach(f=>{
    const fileObj=normalizeFileEntry(f);
    if(!fileObj||fileObj.hidden) return;
    const filePath = baseURL+fileObj.path+getCacheBuster();
    const fileName = fileObj.title||fileObj.path.split("/").pop();
    const link=document.createElement("a");
    link.href="#";
    link.textContent=fileName;
    link.addEventListener("click",()=>loadInContent(filePath,fileName));
    container.appendChild(link);
  });
}

// Load content into right panel
function loadInContent(fileUrl,title){
  const content=document.getElementById("content");
  content.innerHTML=`<h2>${title}</h2><p>Loading...</p>`;
  if(fileUrl.toLowerCase().endsWith(".pdf")){
    content.innerHTML=`<h2>${title}</h2>
      <div class="pdf-controls">
        <button onclick="window.open('${fileUrl}','_blank')">Download PDF</button>
      </div>
      <embed src="${fileUrl}" type="application/pdf" width="100%" height="calc(100vh - 100px)" />
    `;
    return;
  }
  fetch(fileUrl).then(res=>{if(!res.ok) throw new Error("Failed to load file");return res.text();})
  .then(text=>{
    if(fileUrl.endsWith(".html")||fileUrl.endsWith(".htm")) content.innerHTML=`<h2>${title}</h2>`+text;
    else content.innerHTML=`<h2>${title}</h2><pre>${text}</pre>`;
  })
  .catch(err=>{content.innerHTML=`<h2>${title}</h2><p style="color:red;">Error: ${err.message}</p>`;});
}

// Accordion behavior
document.querySelectorAll(".accordion").forEach(btn=>{
  btn.addEventListener("click",function(){
    this.classList.toggle("active");
    const panel=this.nextElementSibling;
    panel.style.display=panel.style.display==="block"?"none":"block";
  });
});

// Load data.json
async function loadData(force=false){
  if(force) localStorage.removeItem("pythonNotesData");
  let data=localStorage.getItem("pythonNotesData");
  if(data) data=JSON.parse(data);
  else{
    try{
      const res=await fetch(baseURL+"data.json"+getCacheBuster(),{cache:"no-store"});
      if(!res.ok) throw new Error("Failed to fetch data.json");
      data=await res.json();
      try{localStorage.setItem("pythonNotesData",JSON.stringify(data));}catch(e){}
    }catch(err){alert("Error loading data: "+err.message);return;}
  }

  renderList("syllabus-list",data.syllabus);
  renderUnits("notes-list",data.notes);
  renderUnits("programs-list",data.programs);
  renderUnits("assignments-list",data.assignments);
  renderList("ebooks-list",data.ebooks);
  renderList("exampapers-list",data.exampapers);
}

// Refresh button
document.getElementById("refreshBtn").addEventListener("click",()=>loadData(true));
loadData(false);
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Python Notes Repository</title>
<style>
  html { scroll-padding-top: 100px; }
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f7fa; color:#333; }
  header { background:#2d6cdf; color:white; padding:20px; text-align:center; position:sticky; top:0; z-index:1000; }
  header h1 { margin:0; font-size:2em; }
  header p { margin:5px 0 0 0; font-size:0.9em; }
  nav { margin-top:10px; }
  nav a { color:white; text-decoration:none; margin:0 10px; font-weight:bold; padding:5px 10px; border-radius:4px; transition:0.3s; display:inline-block; margin-bottom:5px; }
  nav a:hover { text-decoration:underline; color:#ffdd57; }
  nav a.active { background:#ffdd57; color:#2d6cdf; }
  #refreshBtn { background:#ffdd57; color:#2d6cdf; border:none; padding:6px 12px; border-radius:5px; cursor:pointer; font-weight:bold; margin-top:10px; }
  #refreshBtn:hover { background:#ffd633; }
  h2 { background:#e8eefc; padding:10px; border-left:6px solid #2d6cdf; margin-top:30px; }
  li { margin:5px 0; padding:5px 10px; word-break:break-word; display:block; }
  .actions { float:right; }
  .unit-content li .actions { display:inline-block; margin-top:3px; float:none; }
  b.unit-title, b.ebook-title { cursor:pointer; display:inline-block; color:#2d6cdf; margin:10px 0; padding:5px 10px; text-align:left; }
  a { text-decoration:none; color:#1a4bb7; font-weight:500; }
  a:hover { text-decoration:underline; color:#d35400; }
  .download { background:#2d6cdf; color:white; padding:2px 8px; border-radius:5px; font-size:0.85em; margin-left:5px; white-space:nowrap; }
  .download:hover { background:#ff5733; }
  .unit-content { display:none; margin-left:20px; margin-top:5px; }
  .container { max-width:900px; width:95%; margin:auto; padding:20px; background:white; box-shadow:0 0 10px rgba(0,0,0,0.1); border-radius:8px; }
  footer { text-align:center; padding:15px; margin-top:30px; background:#2d6cdf; color:white; }
  @media(max-width:600px){
    nav a { margin:3px 2px; padding:5px 8px; font-size:0.85em; }
    .container { padding:15px; }
    b.unit-title,b.ebook-title { font-size:1em; display:block; }
  }
</style>
</head>
<body>

<header>
  <h1>ðŸ“˜ Python Notes Repository</h1>
  <p>:BMC301:  :Python Programming:  :MCA 3rd Semester:</p>
  <nav>
    <a href="#syllabus">Syllabus</a>
    <a href="#notes">Notes</a>
    <a href="#programs">Programs</a>
    <a href="#assignments">Assignments</a>
    <a href="#ebooks">Ebooks</a>
  </nav>
  <button id="refreshBtn">ðŸ”„ Refresh Data</button>
</header>

<div class="container">
  <h2 id="syllabus">Syllabus</h2>
  <div id="syllabus-list"></div>

  <h2 id="notes">Notes</h2>
  <div id="notes-list"></div>

  <h2 id="programs">Programs</h2>
  <div id="programs-list"></div>

  <h2 id="assignments">Assignments</h2>
  <div id="assignments-list"></div>

  <h2 id="ebooks">Ebooks</h2>
  <div id="ebooks-list"></div>
</div>

<footer>
  Developed & Maintained by Naveen Upreti | 2025
</footer>

<script>
// ===== Utility to Render Files =====
function renderFileList(containerId, files) {
  const container = document.getElementById(containerId);
  const ul = document.createElement("ul");
  ul.className = "unit-content";

  files.forEach(f => {
    const li = document.createElement("li");
    const filePath = f.path.replace(/^.*?\/(Syllabus|ebooks|Notes|Programs|Assignments)/, "$1");
    li.innerHTML = `
      ${f.name}
      <span class="actions">
        <a href="${filePath}" target="_blank">View</a>
        <a class="download" href="${filePath}" download>Download</a>
      </span>
    `;
    ul.appendChild(li);
  });

  container.appendChild(ul);
}

// ===== GitHub API Fetcher with Caching =====
async function fetchGitHubDir(path, forceRefresh = false) {
  const cacheKey = `gh-cache-${path}`;
  const expiry = 1000 * 60 * 60; // 1 hour

  if (!forceRefresh) {
    const cached = localStorage.getItem(cacheKey);
    if (cached) {
      const { timestamp, data } = JSON.parse(cached);
      if (Date.now() - timestamp < expiry) {
        return data; // âœ… return cached
      }
    }
  }

  const url = `https://api.github.com/repos/naveenupreti/Python-Notes/contents/${path}`;
  const res = await fetch(url);
  const data = await res.json();

  // Save to cache
  localStorage.setItem(cacheKey, JSON.stringify({ timestamp: Date.now(), data }));

  return data;
}

// ===== Render All Sections =====
async function renderAll(forceRefresh = false) {
  // Clear previous content
  ["syllabus","notes","programs","assignments","ebooks"].forEach(id => {
    document.getElementById(`${id}-list`).innerHTML = "";
  });

  // --- Syllabus ---
  const syllabusContainer = document.getElementById("syllabus-list");
  const syllabusHeader = document.createElement("b");
  syllabusHeader.className = "unit-title";
  syllabusHeader.textContent = "Syllabus";
  syllabusContainer.appendChild(syllabusHeader);
  renderFileList("syllabus-list", await fetchGitHubDir("Syllabus", forceRefresh));

  // --- Notes ---
  const notesContainer = document.getElementById("notes-list");
  const noteUnits = await fetchGitHubDir("Notes", forceRefresh);
  for (const unit of noteUnits) {
    if (unit.type === "dir") {
      const li = document.createElement("li");
      li.innerHTML = `<b class="unit-title">${unit.name}</b>`;
      const ul = document.createElement("ul");
      ul.className = "unit-content";

      const files = await fetchGitHubDir(unit.path, forceRefresh);
      files.forEach(f => {
        const liFile = document.createElement("li");
        const filePath = f.path.replace(/^.*?\/Notes/, "Notes");
        liFile.innerHTML = `
          ${f.name}
          <span class="actions">
            <a href="${filePath}" target="_blank">View</a>
            <a class="download" href="${filePath}" download>Download</a>
          </span>
        `;
        ul.appendChild(liFile);
      });

      li.appendChild(ul);
      notesContainer.appendChild(li);
    }
  }

  // --- Programs ---
  const progContainer = document.getElementById("programs-list");
  const progUnits = await fetchGitHubDir("Programs", forceRefresh);
  for (const unit of progUnits) {
    if (unit.type === "dir") {
      const li = document.createElement("li");
      li.innerHTML = `<b class="unit-title">${unit.name}</b>`;
      const ul = document.createElement("ul");
      ul.className = "unit-content";

      const files = await fetchGitHubDir(unit.path, forceRefresh);
      files.forEach(f => {
        const liFile = document.createElement("li");
        const filePath = f.path.replace(/^.*?\/Programs/, "Programs");
        liFile.innerHTML = `
          ${f.name}
          <span class="actions">
            <a href="${filePath}" target="_blank">View</a>
            <a class="download" href="${filePath}" download>Download</a>
          </span>
        `;
        ul.appendChild(liFile);
      });

      li.appendChild(ul);
      progContainer.appendChild(li);
    }
  }

  // --- Assignments ---
  const assignContainer = document.getElementById("assignments-list");
  const assignUnits = await fetchGitHubDir("Assignments", forceRefresh);
  for (const unit of assignUnits) {
    if (unit.type === "dir") {
      const li = document.createElement("li");
      li.innerHTML = `<b class="unit-title">${unit.name}</b>`;
      const ul = document.createElement("ul");
      ul.className = "unit-content";

      const files = await fetchGitHubDir(unit.path, forceRefresh);
      files.forEach(f => {
        const liFile = document.createElement("li");
        const filePath = f.path.replace(/^.*?\/Assignments/, "Assignments");
        liFile.innerHTML = `
          ${f.name}
          <span class="actions">
            <a href="${filePath}" target="_blank">View</a>
            <a class="download" href="${filePath}" download>Download</a>
          </span>
        `;
        ul.appendChild(liFile);
      });

      li.appendChild(ul);
      assignContainer.appendChild(li);
    }
  }

  // --- Ebooks ---
  const ebooksContainer = document.getElementById("ebooks-list");
  const ebookHeader = document.createElement("b");
  ebookHeader.className = "ebook-title";
  ebookHeader.textContent = "Ebooks";
  ebooksContainer.appendChild(ebookHeader);
  renderFileList("ebooks-list", await fetchGitHubDir("ebooks", forceRefresh));

  // --- Expand/Collapse Handler ---
  document.querySelectorAll(".unit-title, .ebook-title").forEach(title => {
    title.addEventListener("click", () => {
      const content = title.nextElementSibling;
      if (content) content.style.display = content.style.display === "block" ? "none" : "block";
    });
  });
}

// ===== Initialize Page =====
renderAll();

// ===== Refresh Button Handler =====
document.getElementById("refreshBtn").addEventListener("click", () => {
  Object.keys(localStorage).forEach(k => {
    if (k.startsWith("gh-cache-")) localStorage.removeItem(k);
  });
  renderAll(true);
});
</script>
</body>
</html>
